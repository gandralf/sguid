{"version":3,"sources":["../src/fromSguid.js"],"names":["fromSguid","base64PublicKey","expectedNamespace","expectedResourceTypeName","sguid","payload","nacl","sign","open","JSON","parse","error","InvalidSguidError","namespace","UnexpectedNamespaceValueError","type","UnexpectedResourceTypeNameValueError","id"],"mappings":";;;;;;AAEA;;;;AACA;;AAIA;;AAGA;;;;AAVA;;AAmBA;;;;;;;;AAKA,IAAMA,gCAA2B,SAA3BA,SAA2B,CAACC,eAAD,EAAkBC,iBAAlB,EAAqCC,wBAArC,EAA+DC,KAA/D,EAAyE;AACxG,MAAIC,gBAAJ;;AAEA,MAAI;AACFA,cAAUC,oBAAKC,IAAL,CAAUC,IAAV,CAAe,iCAAaJ,KAAb,CAAf,EAAoC,iCAAa,yBAAYH,eAAZ,CAAb,CAApC,CAAV;;AAEA,QAAII,YAAY,IAAhB,EAAsB;AACpBA,gBAAUI,KAAKC,KAAL,CAAW,+BAAWL,OAAX,CAAX,CAAV;AACD;AACF,GAND,CAME,OAAOM,KAAP,EAAc;AACd,UAAM,IAAIC,yBAAJ,CAAsBR,KAAtB,CAAN;AACD;;AAED,MAAIC,YAAY,IAAhB,EAAsB;AACpB,UAAM,IAAIO,yBAAJ,CAAsBR,KAAtB,CAAN;AACD;;AAED,MAAIF,sBAAsBG,QAAQQ,SAAlC,EAA6C;AAC3C,UAAM,IAAIC,qCAAJ,CAAkCV,KAAlC,EAAyCF,iBAAzC,EAA4DC,wBAA5D,EAAsFE,OAAtF,CAAN;AACD;;AAED,MAAIF,6BAA6BE,QAAQU,IAAzC,EAA+C;AAC7C,UAAM,IAAIC,4CAAJ,CAAyCZ,KAAzC,EAAgDF,iBAAhD,EAAmEC,wBAAnE,EAA6FE,OAA7F,CAAN;AACD;;AAED,SAAO;AACLY,QAAIZ,QAAQY,EADP;AAELJ,eAAWR,QAAQQ,SAFd;AAGLE,UAAMV,QAAQU;AAHT,GAAP;AAKD,CA9BD;;kBAgCef,S","file":"fromSguid.js","sourcesContent":["// @flow\n\nimport nacl from 'tweetnacl';\nimport {\n  decodeBase64,\n  encodeUTF8\n} from 'tweetnacl-util';\nimport {\n  unescape as urlUnescape\n} from 'base64-url';\nimport {\n  InvalidSguidError,\n  UnexpectedNamespaceValueError,\n  UnexpectedResourceTypeNameValueError\n} from './errors';\nimport type {\n  FromSguidType\n} from './types';\n\n/**\n * @throws InvalidSguidError Throws if signed message cannot be opened.\n * @throws UnexpectedNamespaceValueError Throws if the namespace contained in the payload does not match the expected namespace.\n * @throws UnexpectedResourceTypeNameValueError Throws if the resource type name contained in the payload does not match the expected resource type name.\n */\nconst fromSguid: FromSguidType = (base64PublicKey, expectedNamespace, expectedResourceTypeName, sguid) => {\n  let payload;\n\n  try {\n    payload = nacl.sign.open(decodeBase64(sguid), decodeBase64(urlUnescape(base64PublicKey)));\n\n    if (payload !== null) {\n      payload = JSON.parse(encodeUTF8(payload));\n    }\n  } catch (error) {\n    throw new InvalidSguidError(sguid);\n  }\n\n  if (payload === null) {\n    throw new InvalidSguidError(sguid);\n  }\n\n  if (expectedNamespace !== payload.namespace) {\n    throw new UnexpectedNamespaceValueError(sguid, expectedNamespace, expectedResourceTypeName, payload);\n  }\n\n  if (expectedResourceTypeName !== payload.type) {\n    throw new UnexpectedResourceTypeNameValueError(sguid, expectedNamespace, expectedResourceTypeName, payload);\n  }\n\n  return {\n    id: payload.id,\n    namespace: payload.namespace,\n    type: payload.type\n  };\n};\n\nexport default fromSguid;\n"]}